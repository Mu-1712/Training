-----------------------------------------------------------------------------------------------------
ms sql server
-----------------------------------------------------------------------------------------------------
editions:
-----------------------------------------------------------------------------------------------------
1.	enterprise	complete features 
----------------------------------------------------------------------------------------------------- 
2.	standard 	lack of advanced features
-----------------------------------------------------------------------------------------------------
3.	workgroup 	remote offices 
-----------------------------------------------------------------------------------------------------
4.	web 		web applications
-----------------------------------------------------------------------------------------------------
5.	developer 	licensed for development
-----------------------------------------------------------------------------------------------------
5.	express 	free entry level database
-----------------------------------------------------------------------------------------------------
			it can utilize only 1 CPU and 1 GB memory
-----------------------------------------------------------------------------------------------------
			the maximum size of the database is 10 GB
-----------------------------------------------------------------------------------------------------
6.	compact 	free embedded database for mobile application development, max dB 4GB
-----------------------------------------------------------------------------------------------------
7.	datacenter 	no memory limitation, more than 25 instances
-----------------------------------------------------------------------------------------------------
8.	bi		Power View, PowerPivot
-----------------------------------------------------------------------------------------------------
9.	enterprise 	free instance of SQL Server for learning and developing solutions
	evaluation	built-in expiry of 6 months 
-----------------------------------------------------------------------------------------------------
features:
-----------------------------------------------------------------------------------------------------
1.	SQL Server Analysis Services (SSAS)
-----------------------------------------------------------------------------------------------------
2.	SQL Server Reporting Services (SSRS)
-----------------------------------------------------------------------------------------------------
3. 	ETL SQL Server Integration Services (SSIS)
-----------------------------------------------------------------------------------------------------
components:	a. work station		b. server
-----------------------------------------------------------------------------------------------------
1.	work station
-----------------------------------------------------------------------------------------------------
	a.	SSMS
-----------------------------------------------------------------------------------------------------
	b.	SSCM
-----------------------------------------------------------------------------------------------------
	c.	Profiler
-----------------------------------------------------------------------------------------------------
	d.	BIDS
-----------------------------------------------------------------------------------------------------
	e.	SQLEM
-----------------------------------------------------------------------------------------------------
2.	server
-----------------------------------------------------------------------------------------------------
	a.	SQL Server
-----------------------------------------------------------------------------------------------------
	b.	SQL Server Agent
-----------------------------------------------------------------------------------------------------
	c.	SSIS
-----------------------------------------------------------------------------------------------------
	d.	SSAS
-----------------------------------------------------------------------------------------------------
	e.	SSRS
-----------------------------------------------------------------------------------------------------
	f.	SQL browser
-----------------------------------------------------------------------------------------------------
	g.	SQL Server full text search 
-----------------------------------------------------------------------------------------------------
instance:
-----------------------------------------------------------------------------------------------------
	it is an installation of SQL Server
-----------------------------------------------------------------------------------------------------
	it is an exact copy of the same software
-----------------------------------------------------------------------------------------------------
	instance are of 2 types : 			a. default 	b. named
-----------------------------------------------------------------------------------------------------
1.	default instances
-----------------------------------------------------------------------------------------------------
		it will take the server name as Instance name
-----------------------------------------------------------------------------------------------------
		its service name will be MSSQLSERVER
-----------------------------------------------------------------------------------------------------
		only one default instance for one Server
-----------------------------------------------------------------------------------------------------
2.	named instances
-----------------------------------------------------------------------------------------------------
		multiple named instances will be supported in one Server.
-----------------------------------------------------------------------------------------------------
		50+ instances by latest versions
-----------------------------------------------------------------------------------------------------
instance advantages:
-----------------------------------------------------------------------------------------------------
	1.	different versions on one machine
-----------------------------------------------------------------------------------------------------
	2.	cost reduction
-----------------------------------------------------------------------------------------------------
	3.	isolation of production, development, test environments
-----------------------------------------------------------------------------------------------------
	4.	reduced temporary database problems
-----------------------------------------------------------------------------------------------------
	5.	assignment of separate security privileges
-----------------------------------------------------------------------------------------------------
	6.	acts as a standby server
-----------------------------------------------------------------------------------------------------
architecture:	a. general	b. memory	c. data file	d. log file
-----------------------------------------------------------------------------------------------------
a. general architecture
-----------------------------------------------------------------------------------------------------
	1.client
-----------------------------------------------------------------------------------------------------
		request initiated
-----------------------------------------------------------------------------------------------------
	2.query
-----------------------------------------------------------------------------------------------------
		SQL query
-----------------------------------------------------------------------------------------------------
	3.logical units
-----------------------------------------------------------------------------------------------------
		keywords | expressions | operators
-----------------------------------------------------------------------------------------------------
	4.packets
-----------------------------------------------------------------------------------------------------
		network code
-----------------------------------------------------------------------------------------------------
	5.protocols
-----------------------------------------------------------------------------------------------------
		a. shared memory
-----------------------------------------------------------------------------------------------------
			local connections | troubleshooting
-----------------------------------------------------------------------------------------------------
		b. named pipes
-----------------------------------------------------------------------------------------------------
			lan connectivity
-----------------------------------------------------------------------------------------------------
		c. tcp/ip
-----------------------------------------------------------------------------------------------------
			wan connectivity
-----------------------------------------------------------------------------------------------------
		d. via	Virtual Interface Adapter
-----------------------------------------------------------------------------------------------------
			special hardware required		
-----------------------------------------------------------------------------------------------------
	6.server
-----------------------------------------------------------------------------------------------------
		sql services | dB
-----------------------------------------------------------------------------------------------------
	7.relational engine
-----------------------------------------------------------------------------------------------------
		contains Query parser, Query optimizer and Query executor
-----------------------------------------------------------------------------------------------------
	8.query parser
-----------------------------------------------------------------------------------------------------
		check query syntax
-----------------------------------------------------------------------------------------------------
	9.query compiler | translator
-----------------------------------------------------------------------------------------------------
		query to machine language
-----------------------------------------------------------------------------------------------------
	10.query optimizer
-----------------------------------------------------------------------------------------------------
		input	: query, statistics, tree
-----------------------------------------------------------------------------------------------------
		output	: execution plan
-----------------------------------------------------------------------------------------------------
	11.execution plan
-----------------------------------------------------------------------------------------------------
		order of execution 
-----------------------------------------------------------------------------------------------------
	12.query executor
-----------------------------------------------------------------------------------------------------
		query execution as per plan
-----------------------------------------------------------------------------------------------------
	13.storage engine
-----------------------------------------------------------------------------------------------------
		data storage | manipulation | locking | transactions
-----------------------------------------------------------------------------------------------------
	14.sql os
-----------------------------------------------------------------------------------------------------
		interface between os and ms sql server
-----------------------------------------------------------------------------------------------------
		monitors dB activities
-----------------------------------------------------------------------------------------------------
		performs memory management	
-----------------------------------------------------------------------------------------------------
	15.check point 	
-----------------------------------------------------------------------------------------------------
		internal process: 	writes dirty pages | cache -> disk	
-----------------------------------------------------------------------------------------------------
								dirty pages hardening
-----------------------------------------------------------------------------------------------------
					writes log records | log cache -> log files
-----------------------------------------------------------------------------------------------------
					dedicated process
-----------------------------------------------------------------------------------------------------
					runs automatically at specified intervals
-----------------------------------------------------------------------------------------------------
					every db -> separate process
-----------------------------------------------------------------------------------------------------
					reduces recovery time -> shutdown | crash
-----------------------------------------------------------------------------------------------------
		a. automatic
-----------------------------------------------------------------------------------------------------	
			runs in background
-----------------------------------------------------------------------------------------------------
			recovers dB ->	server configuration option -> recovery interval
-----------------------------------------------------------------------------------------------------
		b. indirect	
-----------------------------------------------------------------------------------------------------
			runs in background
-----------------------------------------------------------------------------------------------------
			user specific database
-----------------------------------------------------------------------------------------------------
			user specific recovery time ->	Target_Recovery_Time		
-----------------------------------------------------------------------------------------------------
		c. manual
-----------------------------------------------------------------------------------------------------
			T-SQL command 
-----------------------------------------------------------------------------------------------------
			runs to its completion -> Checkpoint_Duration
-----------------------------------------------------------------------------------------------------
			runs for the selected current database only			
-----------------------------------------------------------------------------------------------------
		d. internal
-----------------------------------------------------------------------------------------------------
			no user control
-----------------------------------------------------------------------------------------------------
			issued on specific operations:
-----------------------------------------------------------------------------------------------------
				1.shut down
-----------------------------------------------------------------------------------------------------
				2.recovery
-----------------------------------------------------------------------------------------------------
				3.dB alter
-----------------------------------------------------------------------------------------------------
				4.dB snapshot
-----------------------------------------------------------------------------------------------------
lazy writer process 
-----------------------------------------------------------------------------------------------------
	it will push dirty pages to disk as it needs to free up memory in the buffer pool
-----------------------------------------------------------------------------------------------------
	it is controlled by an internal process
-----------------------------------------------------------------------------------------------------
	there is no setting for it
-----------------------------------------------------------------------------------------------------
	it uses LRU -> least recently used pages algorithm
-----------------------------------------------------------------------------------------------------
	bottle neck, if it is always active
-----------------------------------------------------------------------------------------------------
b. memory architecture
-----------------------------------------------------------------------------------------------------
	to minimize disk I/O 
-----------------------------------------------------------------------------------------------------
	virtual address space
-----------------------------------------------------------------------------------------------------
		1.kernel mode | OS mode
-----------------------------------------------------------------------------------------------------
		2.user mode| application mode
-----------------------------------------------------------------------------------------------------
	user address space region: 2 parts	
-----------------------------------------------------------------------------------------------------
		1.MemToLeave 	MTL
-----------------------------------------------------------------------------------------------------
		2.BufferPool 	BPool
-----------------------------------------------------------------------------------------------------
	buffer management component consists of two mechanisms:
-----------------------------------------------------------------------------------------------------
		1.buffer manager to access, update dB pages
-----------------------------------------------------------------------------------------------------
		2.buffer pool to reduce database file I/O
-----------------------------------------------------------------------------------------------------
	buffer pool is further divided:
-----------------------------------------------------------------------------------------------------
		1.buffer cache | data cache
-----------------------------------------------------------------------------------------------------
			holds data pages in memory
-----------------------------------------------------------------------------------------------------
		2.procedure cache
-----------------------------------------------------------------------------------------------------
			stored procedures | query execution plans
-----------------------------------------------------------------------------------------------------
			DBCC PROCCACHE statement
-----------------------------------------------------------------------------------------------------
		3.system data 
-----------------------------------------------------------------------------------------------------
			holds instance level data | dB | locks
-----------------------------------------------------------------------------------------------------
		4.log cache
-----------------------------------------------------------------------------------------------------
			transaction log pages | read | write
-----------------------------------------------------------------------------------------------------
		5.connection 
-----------------------------------------------------------------------------------------------------
			to store status of connection
-----------------------------------------------------------------------------------------------------
			stored procedure | user defined function parameters | cursor positions
-----------------------------------------------------------------------------------------------------
		6.stack
-----------------------------------------------------------------------------------------------------
			for each started thread
-----------------------------------------------------------------------------------------------------
c. data file architecture
-----------------------------------------------------------------------------------------------------
	1.file groups
-----------------------------------------------------------------------------------------------------
		data files grouped for admin, security purpose
-----------------------------------------------------------------------------------------------------
		file can belong to only one group
-----------------------------------------------------------------------------------------------------
		log files are not part of groups
-----------------------------------------------------------------------------------------------------
		file groups type:
-----------------------------------------------------------------------------------------------------
			a. primary file group
-----------------------------------------------------------------------------------------------------
				contains primary data file
-----------------------------------------------------------------------------------------------------
				also contains other misc. files
-----------------------------------------------------------------------------------------------------
				contains all system pages 	
-----------------------------------------------------------------------------------------------------
			b. user defined file group
-----------------------------------------------------------------------------------------------------
				create | alter dB
-----------------------------------------------------------------------------------------------------
				each dB has one default file group
-----------------------------------------------------------------------------------------------------
				primary group is the default file group
-----------------------------------------------------------------------------------------------------
	2.files		
-----------------------------------------------------------------------------------------------------
		a. primary data file
-----------------------------------------------------------------------------------------------------
			it is the starting point of the database
-----------------------------------------------------------------------------------------------------
			it points to other files in the dB		
-----------------------------------------------------------------------------------------------------
			each dB has a primary data file
-----------------------------------------------------------------------------------------------------
			extension is ".mdf"
-----------------------------------------------------------------------------------------------------
		b. secondary data file
-----------------------------------------------------------------------------------------------------
			each dB can have multiple secondary data files
-----------------------------------------------------------------------------------------------------
			extension is ".ndf"
-----------------------------------------------------------------------------------------------------
		c. log file
-----------------------------------------------------------------------------------------------------
			contains log information
-----------------------------------------------------------------------------------------------------
			used in the recovery activities
-----------------------------------------------------------------------------------------------------
			each dB can have multiple log files
-----------------------------------------------------------------------------------------------------
			extension is ".ldf"
-----------------------------------------------------------------------------------------------------
		all file locations -> master dB + primary data file
-----------------------------------------------------------------------------------------------------
		file names: 
-----------------------------------------------------------------------------------------------------
			1.logical
-----------------------------------------------------------------------------------------------------
				to refer file in T-SQL
-----------------------------------------------------------------------------------------------------
			2.physical
-----------------------------------------------------------------------------------------------------
				referred by os
-----------------------------------------------------------------------------------------------------
		32,767 files max in one dB
-----------------------------------------------------------------------------------------------------
	3.extents	
-----------------------------------------------------------------------------------------------------
		unit memory allocated to tables, indices
-----------------------------------------------------------------------------------------------------
		it is 8 contiguous pages : 64KB 
-----------------------------------------------------------------------------------------------------
		one page is 8KB
-----------------------------------------------------------------------------------------------------
		extents are of 2 types:
-----------------------------------------------------------------------------------------------------
			a. uniform
-----------------------------------------------------------------------------------------------------
				only one single object
-----------------------------------------------------------------------------------------------------
			b. mixed
-----------------------------------------------------------------------------------------------------
				can be shared by maximum 8 objects
-----------------------------------------------------------------------------------------------------
	4.pages
-----------------------------------------------------------------------------------------------------
		basic unit of storage : 8KB
-----------------------------------------------------------------------------------------------------
		each page : 96 byte header
-----------------------------------------------------------------------------------------------------
		header : page type | free space | object id
-----------------------------------------------------------------------------------------------------
		page types:
-----------------------------------------------------------------------------------------------------
			a. data page
-----------------------------------------------------------------------------------------------------
				data row
-----------------------------------------------------------------------------------------------------
				except text | ntext | image
-----------------------------------------------------------------------------------------------------
			b. index page
-----------------------------------------------------------------------------------------------------
				index entries
-----------------------------------------------------------------------------------------------------
			c. text/image page
-----------------------------------------------------------------------------------------------------
				text | image | ntext data
-----------------------------------------------------------------------------------------------------
			d. gam
-----------------------------------------------------------------------------------------------------
				allocated extents information
-----------------------------------------------------------------------------------------------------
			e. sgam
-----------------------------------------------------------------------------------------------------
				system level allocated extents information
-----------------------------------------------------------------------------------------------------
			f. page free space : pfs
-----------------------------------------------------------------------------------------------------
			g.index allocation map : iam
-----------------------------------------------------------------------------------------------------
				information about extents used by tables, indexes
-----------------------------------------------------------------------------------------------------
			h. bulk changed map : bam
-----------------------------------------------------------------------------------------------------
				information about extents modified by bulk operations
-----------------------------------------------------------------------------------------------------
			i. differential changed map : dcm
-----------------------------------------------------------------------------------------------------
				information about the extents, which got modified
-----------------------------------------------------------------------------------------------------
				since the last backup
-----------------------------------------------------------------------------------------------------
d.log file architecture
-----------------------------------------------------------------------------------------------------
	lsn : logical sequence number
-----------------------------------------------------------------------------------------------------
		each log record has a unique lsn
-----------------------------------------------------------------------------------------------------
	log records contain:
-----------------------------------------------------------------------------------------------------
		1.logical operations performed
-----------------------------------------------------------------------------------------------------
		2.images of the modified data before | after the operation
-----------------------------------------------------------------------------------------------------
	recovery operation depends on the log record type:
-----------------------------------------------------------------------------------------------------
		1.logical operation logged
-----------------------------------------------------------------------------------------------------
			to roll the logical operation forward, the operation is 
				performed again
-----------------------------------------------------------------------------------------------------
			to roll the logical operation back, the reverse logical 
				operation is performed
-----------------------------------------------------------------------------------------------------
		2.before and after image logged
-----------------------------------------------------------------------------------------------------
			to roll the operation forward, the after image is applied
-----------------------------------------------------------------------------------------------------
			to roll the operation back, the before image is applied
-----------------------------------------------------------------------------------------------------
	operations recorded in transaction log
-----------------------------------------------------------------------------------------------------
		1.transaction start | end
-----------------------------------------------------------------------------------------------------
		2.DDL|DML
-----------------------------------------------------------------------------------------------------
		3.extent | page allocation | deallocation
-----------------------------------------------------------------------------------------------------
		4.table|index create | drop
-----------------------------------------------------------------------------------------------------
	rollback operations are also logged. 
-----------------------------------------------------------------------------------------------------
	each transaction reserves space on the transaction log to make sure that 
	enough log space exists to support a rollback that is caused by 
	either an explicit rollback statement or if an error is encountered
-----------------------------------------------------------------------------------------------------
	this reserved space is freed when the transaction is completed
-----------------------------------------------------------------------------------------------------
	dB engine divides each physical log file internally into a number of virtual log files
-----------------------------------------------------------------------------------------------------
	virtual log files have no fixed size, and there is no fixed number of virtual log files 
	for a physical log file
-----------------------------------------------------------------------------------------------------
	dB engine chooses the size of the virtual log files dynamically while it is creating 
	or extending log files
-----------------------------------------------------------------------------------------------------
	dB engine tries to maintain a small number of virtual files
-----------------------------------------------------------------------------------------------------
	the size or number of virtual log files cannot be configured or set by administrators
-----------------------------------------------------------------------------------------------------
	the only time virtual log files affect system performance is if the physical 
	log files are defined by small size and growth_increment values
-----------------------------------------------------------------------------------------------------
	the size value is the initial size for the log file and the growth_increment value is 
	the amount of space added to the file every time new space is required
-----------------------------------------------------------------------------------------------------
	if the log files grow to a large size because of many small increments, they will have 
	many virtual log files
-----------------------------------------------------------------------------------------------------
	this can slow down database startup and also log backup and restore operations
-----------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------


	


	





























